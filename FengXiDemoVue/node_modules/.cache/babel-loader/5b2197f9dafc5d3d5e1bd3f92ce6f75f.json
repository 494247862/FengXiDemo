{"remainingRequest":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\babel-loader\\lib\\index.js!D:\\svn\\DeyiBaseDemoVue\\src\\utils\\websocket.js","dependencies":[{"path":"D:\\svn\\DeyiBaseDemoVue\\src\\utils\\websocket.js","mtime":1695102564481},{"path":"D:\\svn\\DeyiBaseDemoVue\\babel.config.js","mtime":1686639387190},{"path":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi5zdHJpbmdpZnkuanMiOwovL+aatOmcsuiHquWumuS5iXdlYnNvY2tldOWvueixoQpleHBvcnQgdmFyIHNvY2tldCA9IHsKICAvL+WQjuWPsOivt+axgui3r+W+hAogIHVybDogIiIsCiAgLy93ZWJzb2NrZXTlr7nosaEKICB3ZWJzb2NrZXQ6IG51bGwsCiAgLy93ZWJzb2NrZXTnirbmgIEKICB3ZWJzb2NrZXRTdGF0ZTogZmFsc2UsCiAgLy/ph43mlrDov57mjqXmrKHmlbAKICByZWNvbm5lY3ROdW06IDAsCiAgLy/ph43ov57plIHnirbmgIHvvIzkv53or4Hph43ov57mjInpobrluo/miafooYwKICBsb2NrUmVjb25uZWN0OiBmYWxzZSwKICAvL+WumuaXtuWZqOS/oeaBrwogIHRpbWVvdXQ6IG51bGwsCiAgY2xpZW50VGltZW91dDogbnVsbCwKICBzZXJ2ZXJUaW1lb3V0OiBudWxsLAogIC8v5Yid5aeL5YyW5pa55rOV77yM5qC55o2udXJs5Yib5bu6d2Vic29ja2V05a+56LGh5bCB6KOF5Z+65pys6L+e5o6l5pa55rOV77yM5bm26YeN572u5b+D6Lez5qOA5rWLCiAgaW5pdFdlYlNvY2tldDogZnVuY3Rpb24gaW5pdFdlYlNvY2tldChuZXdVcmwpIHsKICAgIHNvY2tldC51cmwgPSBuZXdVcmw7CiAgICBzb2NrZXQud2Vic29ja2V0ID0gbmV3IFdlYlNvY2tldChzb2NrZXQudXJsKTsKICAgIHNvY2tldC53ZWJzb2NrZXQub25vcGVuID0gc29ja2V0LndlYnNvY2tldE9uT3BlbjsKICAgIHNvY2tldC53ZWJzb2NrZXQub25lcnJvciA9IHNvY2tldC53ZWJzb2NrZXRPbkVycm9yOwogICAgc29ja2V0LndlYnNvY2tldC5vbmNsb3NlID0gc29ja2V0LndlYnNvY2tldE9uQ2xvc2U7CiAgICAvLyB0aGlzLnJlc2V0SGVhcnRiZWF0KCkKICB9LAogIHJlY29ubmVjdDogZnVuY3Rpb24gcmVjb25uZWN0KCkgewogICAgLy/liKTmlq3ov57mjqXnirbmgIEKICAgIGlmIChzb2NrZXQubG9ja1JlY29ubmVjdCkgcmV0dXJuOwogICAgc29ja2V0LnJlY29ubmVjdE51bSArPSAxOwogICAgLy/ph43mlrDov57mjqXkuInmrKHov5jmnKrmiJDlip/osIPnlKjov57mjqXlhbPpl63mlrnms5UKICAgIGlmIChzb2NrZXQucmVjb25uZWN0TnVtID09PSAzKSB7CiAgICAgIHNvY2tldC5yZWNvbm5lY3ROdW0gPSAwOwogICAgICBzb2NrZXQud2Vic29ja2V0Lm9uY2xvc2UoKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgLy/nrYnlvoXmnKzmrKHph43ov57lrozmiJDlkI7lho3ov5vooYzkuIvkuIDmrKEKICAgIHNvY2tldC5sb2NrUmVjb25uZWN0ID0gdHJ1ZTsKICAgIC8vNXPlkI7ov5vooYzph43mlrDov57mjqUKICAgIHNvY2tldC50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIHNvY2tldC5pbml0V2ViU29ja2V0KHNvY2tldC51cmwpOwogICAgICBzb2NrZXQubG9ja1JlY29ubmVjdCA9IGZhbHNlOwogICAgfSwgNTAwMCk7CiAgfSwKICAvL+mHjee9ruW/g+i3s+ajgOa1iwogIHJlc2V0SGVhcnRiZWF0OiBmdW5jdGlvbiByZXNldEhlYXJ0YmVhdCgpIHsKICAgIHNvY2tldC5oZWFydGJlYXQoKTsKICB9LAogIC8v5b+D6Lez5qOA5rWLCiAgaGVhcnRiZWF0OiBmdW5jdGlvbiBoZWFydGJlYXQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgc29ja2V0LmNsaWVudFRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHNvY2tldC53ZWJzb2NrZXQpIHsKICAgICAgICAvL+WQkeWQjuWPsOWPkemAgea2iOaBr+i/m+ihjOW/g+i3s+ajgOa1iwogICAgICAgIHNvY2tldC53ZWJzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICB0eXBlOiAiaGVhcnRiZWF0IgogICAgICAgIH0pKTsKICAgICAgICBzb2NrZXQud2Vic29ja2V0U3RhdGUgPSBmYWxzZTsKICAgICAgICAvL+S4gOWIhumSn+WGheacjeWKoeWZqOS4jeWTjeW6lOWImeWFs+mXrei/nuaOpQogICAgICAgIHNvY2tldC5zZXJ2ZXJUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoIXNvY2tldC53ZWJzb2NrZXRTdGF0ZSkgewogICAgICAgICAgICBzb2NrZXQud2Vic29ja2V0Lm9uY2xvc2UoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzLnJlc2V0SGVhcnRiZWF0KCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgNCAqIDEwMDApOwogICAgICB9CiAgICB9LCAzICogMTAwMCk7CiAgfSwKICAvL+WPkemAgea2iOaBrwogIHNlbmRNc2c6IGZ1bmN0aW9uIHNlbmRNc2cobWVzc2FnZSkgewogICAgc29ja2V0LndlYnNvY2tldC5zZW5kKG1lc3NhZ2UpOwogIH0sCiAgd2Vic29ja2V0T25PcGVuOiBmdW5jdGlvbiB3ZWJzb2NrZXRPbk9wZW4oZXZlbnQpIHsKICAgIC8v6L+e5o6l5byA5ZCv5ZCO5ZCR5ZCO5Y+w5Y+R6YCB5raI5oGv6L+b6KGM5LiA5qyh5b+D6Lez5qOA5rWLCiAgICAvLyBzb2NrZXQuc2VuZE1zZyhKU09OLnN0cmluZ2lmeSh7IHR5cGU6ICJoZWFydGJlYXQiIH0pKTsKICAgIHNvY2tldC5zZW5kTXNnKCLnrKzkuIDmrKHov57mjqUiKTsKICB9LAogIHdlYnNvY2tldE9uRXJyb3I6IGZ1bmN0aW9uIHdlYnNvY2tldE9uRXJyb3IoZXJyb3IpIHsKICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgIHNvY2tldC5yZWNvbm5lY3QoKTsKICB9LAogIHdlYnNvY2tldE9uQ2xvc2U6IGZ1bmN0aW9uIHdlYnNvY2tldE9uQ2xvc2UoKSB7CiAgICBzb2NrZXQud2Vic29ja2V0LmNsb3NlKCk7CiAgfQp9Ow=="},{"version":3,"names":["socket","url","websocket","websocketState","reconnectNum","lockReconnect","timeout","clientTimeout","serverTimeout","initWebSocket","newUrl","WebSocket","onopen","websocketOnOpen","onerror","websocketOnError","onclose","websocketOnClose","reconnect","setTimeout","resetHeartbeat","heartbeat","send","JSON","stringify","type","sendMsg","message","event","error","console","log","close"],"sources":["D:/svn/DeyiBaseDemoVue/src/utils/websocket.js"],"sourcesContent":["//暴露自定义websocket对象\nexport const socket = {\n  //后台请求路径\n  url: \"\",\n  //websocket对象\n  websocket: null,\n  //websocket状态\n  websocketState: false,\n  //重新连接次数\n  reconnectNum: 0,\n  //重连锁状态，保证重连按顺序执行\n  lockReconnect: false,\n  //定时器信息\n  timeout: null,\n  clientTimeout: null,\n  serverTimeout: null,\n  //初始化方法，根据url创建websocket对象封装基本连接方法，并重置心跳检测\n  initWebSocket(newUrl) {\n    socket.url = newUrl;\n    socket.websocket = new WebSocket(socket.url);\n    socket.websocket.onopen = socket.websocketOnOpen;\n    socket.websocket.onerror = socket.websocketOnError;\n    socket.websocket.onclose = socket.websocketOnClose;\n    // this.resetHeartbeat()\n  },\n  reconnect() {\n    //判断连接状态\n    if (socket.lockReconnect) return;\n    socket.reconnectNum += 1;\n    //重新连接三次还未成功调用连接关闭方法\n    if (socket.reconnectNum === 3) {\n      socket.reconnectNum = 0;\n      socket.websocket.onclose()\n      return;\n    }\n    //等待本次重连完成后再进行下一次\n    socket.lockReconnect = true;\n    //5s后进行重新连接\n    socket.timeout = setTimeout(() => {\n      socket.initWebSocket(socket.url);\n      socket.lockReconnect = false;\n    }, 5000);\n  },\n  //重置心跳检测\n  resetHeartbeat() {\n    socket.heartbeat();\n  },\n  //心跳检测\n  heartbeat() {\n    socket.clientTimeout = setTimeout(() => {\n      if (socket.websocket) {\n        //向后台发送消息进行心跳检测\n        socket.websocket.send(JSON.stringify({ type: \"heartbeat\" }));\n        socket.websocketState = false;\n        //一分钟内服务器不响应则关闭连接\n        socket.serverTimeout = setTimeout(() => {\n          if (!socket.websocketState) {\n            socket.websocket.onclose()\n          } else {\n            this.resetHeartbeat()\n          }\n        }, 4 * 1000);\n      }\n    }, 3 * 1000);\n  },\n  //发送消息\n  sendMsg(message) {\n    socket.websocket.send(message);\n  },\n  websocketOnOpen(event) {\n    //连接开启后向后台发送消息进行一次心跳检测\n    // socket.sendMsg(JSON.stringify({ type: \"heartbeat\" }));\n    socket.sendMsg(\"第一次连接\")\n  },\n  websocketOnError(error) {\n    console.log(error);\n    socket.reconnect();\n  },\n  websocketOnClose() {\n    socket.websocket.close();\n  },\n};\n"],"mappings":";AAAA;AACA,OAAO,IAAMA,MAAM,GAAG;EACpB;EACAC,GAAG,EAAE,EAAE;EACP;EACAC,SAAS,EAAE,IAAI;EACf;EACAC,cAAc,EAAE,KAAK;EACrB;EACAC,YAAY,EAAE,CAAC;EACf;EACAC,aAAa,EAAE,KAAK;EACpB;EACAC,OAAO,EAAE,IAAI;EACbC,aAAa,EAAE,IAAI;EACnBC,aAAa,EAAE,IAAI;EACnB;EACAC,aAAa,yBAACC,MAAM,EAAE;IACpBV,MAAM,CAACC,GAAG,GAAGS,MAAM;IACnBV,MAAM,CAACE,SAAS,GAAG,IAAIS,SAAS,CAACX,MAAM,CAACC,GAAG,CAAC;IAC5CD,MAAM,CAACE,SAAS,CAACU,MAAM,GAAGZ,MAAM,CAACa,eAAe;IAChDb,MAAM,CAACE,SAAS,CAACY,OAAO,GAAGd,MAAM,CAACe,gBAAgB;IAClDf,MAAM,CAACE,SAAS,CAACc,OAAO,GAAGhB,MAAM,CAACiB,gBAAgB;IAClD;EACF,CAAC;EACDC,SAAS,uBAAG;IACV;IACA,IAAIlB,MAAM,CAACK,aAAa,EAAE;IAC1BL,MAAM,CAACI,YAAY,IAAI,CAAC;IACxB;IACA,IAAIJ,MAAM,CAACI,YAAY,KAAK,CAAC,EAAE;MAC7BJ,MAAM,CAACI,YAAY,GAAG,CAAC;MACvBJ,MAAM,CAACE,SAAS,CAACc,OAAO,EAAE;MAC1B;IACF;IACA;IACAhB,MAAM,CAACK,aAAa,GAAG,IAAI;IAC3B;IACAL,MAAM,CAACM,OAAO,GAAGa,UAAU,CAAC,YAAM;MAChCnB,MAAM,CAACS,aAAa,CAACT,MAAM,CAACC,GAAG,CAAC;MAChCD,MAAM,CAACK,aAAa,GAAG,KAAK;IAC9B,CAAC,EAAE,IAAI,CAAC;EACV,CAAC;EACD;EACAe,cAAc,4BAAG;IACfpB,MAAM,CAACqB,SAAS,EAAE;EACpB,CAAC;EACD;EACAA,SAAS,uBAAG;IAAA;IACVrB,MAAM,CAACO,aAAa,GAAGY,UAAU,CAAC,YAAM;MACtC,IAAInB,MAAM,CAACE,SAAS,EAAE;QACpB;QACAF,MAAM,CAACE,SAAS,CAACoB,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC;UAAEC,IAAI,EAAE;QAAY,CAAC,CAAC,CAAC;QAC5DzB,MAAM,CAACG,cAAc,GAAG,KAAK;QAC7B;QACAH,MAAM,CAACQ,aAAa,GAAGW,UAAU,CAAC,YAAM;UACtC,IAAI,CAACnB,MAAM,CAACG,cAAc,EAAE;YAC1BH,MAAM,CAACE,SAAS,CAACc,OAAO,EAAE;UAC5B,CAAC,MAAM;YACL,KAAI,CAACI,cAAc,EAAE;UACvB;QACF,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;MACd;IACF,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;EACd,CAAC;EACD;EACAM,OAAO,mBAACC,OAAO,EAAE;IACf3B,MAAM,CAACE,SAAS,CAACoB,IAAI,CAACK,OAAO,CAAC;EAChC,CAAC;EACDd,eAAe,2BAACe,KAAK,EAAE;IACrB;IACA;IACA5B,MAAM,CAAC0B,OAAO,CAAC,OAAO,CAAC;EACzB,CAAC;EACDX,gBAAgB,4BAACc,KAAK,EAAE;IACtBC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;IAClB7B,MAAM,CAACkB,SAAS,EAAE;EACpB,CAAC;EACDD,gBAAgB,8BAAG;IACjBjB,MAAM,CAACE,SAAS,CAAC8B,KAAK,EAAE;EAC1B;AACF,CAAC"}]}