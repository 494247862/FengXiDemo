{"remainingRequest":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\svn\\DeyiBaseDemoVue\\src\\views\\UserManage\\index.vue?vue&type=style&index=0&id=7ca921cd&lang=scss&scoped=true&","dependencies":[{"path":"D:\\svn\\DeyiBaseDemoVue\\src\\views\\UserManage\\index.vue","mtime":1689328808488},{"path":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\svn\\DeyiBaseDemoVue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiRkYXJrX2dyYXk6ICM4ODlhYTQ7CgoucGFnaW5hdGlvbiB7CiAgd2lkdGg6IDEwMCU7CiAgbWFyZ2luLXRvcDogMjBweDsKICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQoKLlF1ZXJ5Rm9ybSAuZWwtZm9ybS1pdGVtIHsKICBtYXJnaW4tYm90dG9tOiAwOwp9CgouYXBwLWNvbnRhaW5lciB7CiAgLnVzZXJzLXRhYmxlIHsKICAgIG1hcmdpbi10b3A6IDMwcHg7CiAgfQoKICAucGVybWlzc2lvbi10cmVlIHsKICAgIG1hcmdpbi1ib3R0b206IDMwcHg7CiAgfQp9CgoucHdkLWlucHV0IHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgaGVpZ2h0OiA0N3B4OwoKICBpbnB1dCB7CiAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgIGJvcmRlcjogMHB4OwogICAgYm9yZGVyLXJhZGl1czogMHB4OwogICAgcGFkZGluZzogMTJweCA1cHggMTJweCAxNXB4OwogICAgaGVpZ2h0OiA0N3B4OwogIH0KfQoKLnNob3ctcHdkIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgcmlnaHQ6IDEwcHg7CiAgdG9wOiA3cHg7CiAgZm9udC1zaXplOiAxNnB4OwogIGNvbG9yOiAkZGFya19ncmF5OwogIGN1cnNvcjogcG9pbnRlcjsKICB1c2VyLXNlbGVjdDogbm9uZTsKfQoKLnN2Zy1jb250YWluZXIgewogIHBhZGRpbmc6IDZweCA1cHggNnB4IDE1cHg7CiAgY29sb3I6ICRkYXJrX2dyYXk7CiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICB3aWR0aDogMzBweDsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAieA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/UserManage","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-row>\n      <!--      查询条件按-->\n      <el-card style=\"height: 100%\">\n        <el-form\n          class=\"QueryForm\"\n          label-width=\"80px\"\n          label-position=\"right\"\n          :inline=\"true\"\n          :model=\"query\"\n        >\n          <el-form-item label=\"账号:\">\n            <el-input v-model=\"query.account\"/>\n          </el-form-item>\n          <el-form-item label=\"昵称:\">\n            <el-input v-model=\"query.nickName\"/>\n          </el-form-item>\n          <el-form-item label=\"联系方式:\">\n            <el-input v-model=\"query.phone\"/>\n          </el-form-item>\n          <el-form-item label=\"所属角色:\">\n            <el-select\n              v-model=\"queryRoles\"\n              multiple\n              filterable\n              style=\"width: 100%\"\n            >\n              <el-option\n                v-for=\"(role, index) in rolesList\"\n                :key=\"index\"\n                :label=\"role.roleName\"\n                :value=\"role.id\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item class=\"submit-button\">\n            <el-button @click=\"clearQueryData()\">清空</el-button>\n          </el-form-item>\n          <el-form-item class=\"submit-button\">\n            <el-button @click=\"queryTableData()\">查询</el-button>\n          </el-form-item>\n        </el-form>\n      </el-card>\n    </el-row>\n\n    <el-row style=\"margin-top: 10px\">\n      <!--      查询条件按-->\n      <el-card style=\"height: 100%\">\n        <div slot=\"header\" style=\"width: 100%;\n        display: flex;align-items: center;\n          justify-content: space-between;\">\n          <div>\n            <i class=\"el-icon-s-grid\"></i>\n            <span style=\"margin-left: 5px;\">用户数据</span>\n          </div>\n          <div>\n            <el-button @click=\"handleAddUser\" size=\"small\" type=\"primary\" v-if=\"$authButton('addUser')\"> 新增用户\n            </el-button>\n          </div>\n        </div>\n\n        <el-table\n          :data=\"usersList\"\n          style=\"width: 100%; margin-top: 30px\"\n          border\n        >\n          <el-table-column align=\"center\" label=\"账号\" width=\"220\">\n            <template slot-scope=\"scope\">\n              {{ scope.row.account }}\n            </template>\n          </el-table-column>\n          <el-table-column align=\"center\" label=\"昵称\" width=\"220\">\n            <template slot-scope=\"scope\">\n              {{ scope.row.nickName }}\n            </template>\n          </el-table-column>\n          <el-table-column align=\"center\" label=\"角色\">\n            <template slot-scope=\"scope\">\n              <el-tag v-for=\"(item,index) in scope.row.roleList\" style=\"margin-left: 10px;\" :key=\"index\">{{item}}\n              </el-tag>\n            </template>\n          </el-table-column>\n          <el-table-column align=\"center\" label=\"手机号\">\n            <template slot-scope=\"scope\">\n              {{ scope.row.phone }}\n            </template>\n          </el-table-column>\n          <el-table-column align=\"center\" label=\"性别\">\n            <template slot-scope=\"scope\">\n              {{ scope.row.sex }}\n            </template>\n          </el-table-column>\n          <el-table-column align=\"center\" label=\"操作\">\n            <template slot-scope=\"scope\">\n              <el-button type=\"text\" size=\"small\" @click=\"handleEdit(scope)\" v-if=\"$authButton('update')\">\n                编辑\n              </el-button>\n              <el-button style=\"color:orange\" type=\"text\" size=\"small\" @click=\"handleReset(scope)\"\n                         v-if=\"$authButton('resetPassword')\">\n                重置密码\n              </el-button>\n              <el-button\n                v-if=\"$authButton('delete')\"\n                style=\"color:red\"\n                type=\"text\"\n                size=\"small\"\n                @click=\"handleDelete(scope)\"\n              >删除\n              </el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n        <div class=\"pagination\">\n          <el-pagination\n            background\n            layout=\"total, prev, pager, next, jumper\"\n            :total=\"pageCount\"\n            :current-page=\"currentPage\"\n            @current-change=\"pageChange\"\n            :page-sizes=\"[10, 20, 30, 50]\"\n            @size-change=\"sizeChange\"\n          >\n          </el-pagination>\n        </div>\n      </el-card>\n    </el-row>\n\n    <el-dialog\n      width=\"500px\"\n      :close-on-click-modal=\"false\"\n      :visible.sync=\"dialogVisible\"\n      :title=\"dialogType === 'edit' ? '编辑用户' : '新增用户'\"\n    >\n      <el-form :model=\"user\" label-width=\"80px\" ref=\"formRef\" label-position=\"right\">\n        <el-form-item label=\"账号\" prop=\"account\" :rules=\"[{ required: true, message: '账号不能为空'}]\">\n          <el-input\n            v-model=\"user.account\"\n            :readonly=\"dialogType === 'edit'\"\n            placeholder=\"请输入用户账号\"\n          />\n        </el-form-item>\n        <el-form-item label=\"昵称\">\n          <el-input v-model=\"user.nickName\" placeholder=\"请输入用户昵称\"/>\n        </el-form-item>\n        <el-form-item label=\"手机号\">\n          <el-input v-model=\"user.phone\" placeholder=\"请输入手机号\"/>\n        </el-form-item>\n        <el-form-item label=\"性别\">\n          <el-radio-group v-model=\"user.sex\" size=\"small\">\n            <el-radio-button label=\"男\"/>\n            <el-radio-button label=\"女\"/>\n          </el-radio-group>\n        </el-form-item>\n        <el-tooltip\n          v-model=\"capsTooltip\"\n          content=\"大写锁定\"\n          placement=\"right\"\n          manual\n        >\n          <el-form-item label=\"密码\" prop=\"password\"\n                        :rules=\"[{ required: dialogType!=='edit', message: '密码不能为空'}]\">\n            <el-input\n              class=\"pwd-input\"\n              readOnly\n              onfocus=\"this.removeAttribute('readonly');\"\n              onblur=\"this.setAttribute('readonly',true);\"\n              autocomplete=\"on\"\n              :key=\"passwordType\"\n              ref=\"password\"\n              v-model=\"user.password\"\n              :type=\"passwordType\"\n              placeholder=\"密码\"\n              name=\"password\"\n              tabindex=\"4\"\n              @keyup.native=\"checkCapslock\"\n              @blur=\"capsTooltip = false\"\n            />\n            <span class=\"show-pwd\" @click=\"showPwd\">\n              <svg-icon\n                :icon-class=\"passwordType === 'password' ? 'eye' : 'eye-open'\"\n              />\n            </span>\n          </el-form-item>\n        </el-tooltip>\n\n        <el-form-item label=\"选择角色\">\n          <el-select\n            v-model=\"checkRoles\"\n            multiple\n            filterable\n            style=\"width: 100%\"\n          >\n            <el-option\n              v-for=\"(role, index) in rolesList\"\n              :key=\"index\"\n              :label=\"role.roleName\"\n              :value=\"role.id\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"部门\">\n          <el-cascader\n            v-model=\"departmentIds\"\n            style=\"width: 100%\"\n            clearable\n            :props=\"{ checkStrictly: true ,emitPath: false,multiple: true}\"\n            :options=\"departmentOptions\">\n\n          </el-cascader>\n        </el-form-item>\n      </el-form>\n      <div style=\"text-align: right\">\n        <el-button type=\"danger\" @click=\"()=>{this.dialogVisible = false;this.user = {}}\">\n          取消\n        </el-button>\n        <el-button type=\"primary\" @click=\"confirmUser\"> 确认</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n  import {\n    addUser,\n    updateUser,\n    deleteUser,\n    getAllUser,\n    queryUserData\n  } from '@/api/user'\n  import {getAllRoles} from '@/api/role'\n  import {getDepartmentTree} from '@/api/department'\n  import {timingSafeEqual} from 'crypto'\n\n  const defaultUser = {\n    id: '',\n    account: '',\n    nickName: '',\n    password: '',\n    phone: '',\n    sex: '',\n    roleIds: ''\n  }\n\n  const defaultQuery = {\n    account: '',\n    nickName: '',\n    phone: '',\n    sex: '',\n    roleIds: [],\n    page: 1,\n    pageSize: 10\n  }\n\n  export default {\n    name: 'UserManage',\n    data() {\n      return {\n        user: Object.assign({}, defaultUser),\n        query: Object.assign({}, defaultQuery),\n        menusData: [],\n        usersList: [],\n        rolesList: [],\n\n        checkRoles: [],\n        departmentIds: [],\n        queryRoles: [],\n        departmentOptions: [],\n\n        dialogVisible: false,\n        dialogType: 'new',\n        checkStrictly: false,\n        passwordType: 'password',\n        capsTooltip: false,\n\n        pageCount: 1,\n        currentPage: 1\n      }\n    },\n    created() {\n      this.getAllUser()\n      this.getAllRoles()\n    },\n    methods: {\n      getDepartmentTree() {\n        getDepartmentTree().then(res => {\n          this.departmentOptions = this.diyDepartmentTree(res)\n        }).catch(err => {\n          this.$notify.error({\n            title: '获取部门数据错误',\n            message: err.message\n          })\n        })\n      },\n      // 递归处理部门树的数据\n      diyDepartmentTree(list) {\n        let res = []\n        for (let i = 0; i < list.length; i++) {\n          res.push(this.diyDepartmentTreeItem(list[i]))\n        }\n        return res\n      },\n      diyDepartmentTreeItem(data) {\n        let children = []\n        let res = {value: data.id, label: data.departmentName}\n        if (data.children.length > 0) {\n          for (let i = 0; i < data.children.length; i++) {\n            children.push(this.diyDepartmentTreeItem(data.children[i]))\n          }\n        } else {\n          children = null\n        }\n        res.children = children\n        return res\n      },\n      sizeChange(val) {\n        this.query.pageSize = val\n      },\n      //页面改变\n      pageChange(val) {\n        this.currentPage = val\n        this.queryTableData(val)\n      },\n      // 清空\n      clearQueryData() {\n        this.queryRoles = []\n        this.query = Object.assign({}, defaultQuery)\n      },\n      // 查询数据\n      queryTableData(selectPage = 1) {\n        this.query.roleIds = this.queryRoles\n        this.query.page = selectPage\n        this.currentPage = selectPage\n\n        queryUserData(this.query)\n          .then((res) => {\n            this.usersList = res.data\n            this.pageCount = res.count\n          })\n          .catch((err) => {\n            this.$notify.error({\n              title: '错误',\n              message: err.message\n            })\n          })\n      },\n      checkCapslock(e) {\n        const {key} = e\n        this.capsTooltip = key && key.length === 1 && key >= 'A' && key <= 'Z'\n      },\n      showPwd() {\n        if (this.passwordType === 'password') {\n          this.passwordType = ''\n        } else {\n          this.passwordType = 'password'\n        }\n        this.$nextTick(() => {\n          this.$refs.password.focus()\n        })\n      },\n\n      async getAllRoles() {\n        const roles = await getAllRoles()\n        this.rolesList = roles\n      },\n\n      getAllUser() {\n        queryUserData(this.query)\n          .then((res) => {\n            this.usersList = res.data\n            this.pageCount = res.count\n          })\n          .catch((err) => {\n            this.$notify.error({\n              title: '错误',\n              message: err.message\n            })\n          })\n      },\n\n      getCheckedRoles(roleIds) {\n        let data = []\n        if (roleIds && roleIds.length > 0) {\n          data = roleIds.split(',').map(Number)\n        }\n        return data\n      },\n\n      handleAddUser() {\n        this.user = Object.assign({}, defaultUser)\n        this.checkRoles = []\n        this.departmentIds = []\n        this.dialogType = 'new'\n        this.dialogVisible = true\n      },\n      handleEdit(scope) {\n        this.dialogType = 'edit'\n        this.dialogVisible = true\n        this.checkStrictly = true\n        this.user = {...scope.row}\n        this.user.password = ''\n        this.checkRoles = this.getCheckedRoles(this.user.roleIds)\n        this.departmentIds = this.getCheckedRoles(this.user.departmentIds)\n        this.getDepartmentTree()\n      },\n      async handleReset(scope) {\n        this.user = {...scope.row}\n        this.user.password = '12345'\n        this.$confirm('确定要重置此用户密码吗？', 'Warning', {\n          confirmButtonText: '确认',\n          cancelButtonText: '取消',\n          type: 'warning'\n        })\n          .then(async () => {\n            await updateUser(this.user)\n            this.$message({\n              type: 'success',\n              message: '重置成功!'\n            })\n          })\n          .catch((err) => {\n            console.log(err)\n          })\n        await this.getAllUser()\n      },\n\n      handleDelete({$index, row}) {\n        this.$confirm('确定要删除此用户吗？', 'Warning', {\n          confirmButtonText: '确认',\n          cancelButtonText: '取消',\n          type: 'warning'\n        })\n          .then(async () => {\n            await deleteUser(row.id)\n            this.usersList.splice($index, 1)\n            this.$message({\n              type: 'success',\n              message: '删除成功!'\n            })\n          })\n          .catch((err) => {\n            console.error(err)\n          })\n      },\n      async confirmUser() {\n        this.$refs['formRef'].validate(async valid => {\n          if (valid) {\n            const isEdit = this.dialogType === 'edit'\n            this.user.roleIds = this.checkRoles.join() === \"\" ? null : this.checkRoles.join()\n            this.user.departmentIds = this.departmentIds.join() === \"\" ? null : this.departmentIds.join()\n            if (isEdit) {\n              await updateUser(this.user)\n            } else {\n              await addUser(this.user)\n            }\n\n            // await getAllUser()\n            this.queryTableData(this.currentPage)\n\n            const {account, nickName} = this.user\n            this.dialogVisible = false\n            this.$notify({\n              title: '操作成功',\n              dangerouslyUseHTMLString: true,\n              message: `\n              <div>账号: ${account}</div>\n              <div>昵称: ${nickName}</div>\n            `,\n              type: 'success'\n            })\n          } else {\n            return false\n          }\n        })\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  $dark_gray: #889aa4;\n\n  .pagination {\n    width: 100%;\n    margin-top: 20px;\n    display: inline-flex;\n    justify-content: center;\n  }\n\n  .QueryForm .el-form-item {\n    margin-bottom: 0;\n  }\n\n  .app-container {\n    .users-table {\n      margin-top: 30px;\n    }\n\n    .permission-tree {\n      margin-bottom: 30px;\n    }\n  }\n\n  .pwd-input {\n    display: inline-block;\n    height: 47px;\n\n    input {\n      background: transparent;\n      border: 0px;\n      border-radius: 0px;\n      padding: 12px 5px 12px 15px;\n      height: 47px;\n    }\n  }\n\n  .show-pwd {\n    position: absolute;\n    right: 10px;\n    top: 7px;\n    font-size: 16px;\n    color: $dark_gray;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .svg-container {\n    padding: 6px 5px 6px 15px;\n    color: $dark_gray;\n    vertical-align: middle;\n    width: 30px;\n    display: inline-block;\n  }\n</style>\n"]}]}