{"version":3,"file":"index.js","sources":["../src/components/Editor.tsx","../src/components/Toolbar.tsx"],"sourcesContent":["/**\n * @description editor react component\n * @author wangfupeng\n */\n\nimport React, { useRef, useEffect, useState } from 'react'\nimport {SlateDescendant, IEditorConfig, createEditor, IDomEditor, SlateEditor, SlateTransforms } from '@wangeditor/editor'\n\ninterface IProps {\n  defaultContent?: SlateDescendant[]\n  onCreated?: (editor: IDomEditor) => void\n  defaultHtml?: string\n  value?: string\n  onChange: (editor: IDomEditor) => void\n  defaultConfig: Partial<IEditorConfig>\n  mode?: string\n  style?: React.CSSProperties\n  className?: string\n}\n\nfunction EditorComponent(props: Partial<IProps>) {\n  const { defaultContent = [], onCreated, defaultHtml = '', value = '', onChange, defaultConfig = {}, mode = 'default', style = {}, className } = props\n  const ref = useRef<HTMLDivElement>(null)\n  const [editor, setEditor] = useState<IDomEditor | null>(null)\n  const [curValue, setCurValue] = useState('')\n\n  const handleCreated = (editor: IDomEditor) => {\n    // 组件属性 onCreated\n    if (onCreated) onCreated(editor)\n\n    // 编辑器 配置 onCreated\n    const { onCreated: onCreatedFromConfig } = defaultConfig\n    if (onCreatedFromConfig) onCreatedFromConfig(editor)\n  }\n\n  const handleChanged = (editor: IDomEditor) => {\n    setCurValue(editor.getHtml()) // 记录当前 html 值\n\n    // 组件属性 onChange\n    if (onChange) onChange(editor)\n\n    // 编辑器 配置 onChange\n    const { onChange: onChangeFromConfig } = defaultConfig\n    if (onChangeFromConfig) onChangeFromConfig(editor)\n  }\n\n  const handleDestroyed = (editor: IDomEditor) => {\n    const { onDestroyed } = defaultConfig\n    setEditor(null)\n    if(onDestroyed) {\n      onDestroyed(editor)\n    }\n  }\n\n  // value 变化，重置 HTML\n  useEffect(() => {\n    if (editor == null) return\n\n    if (value === curValue) return // 如果和当前 html 值相等，则忽略\n\n    // ------ 重新设置 HTML ------\n    try {\n      editor.setHtml(value)\n    } catch (error) {\n      console.error(error)\n    }\n\n  }, [value])\n\n  useEffect(() => {\n    if (ref.current == null) return\n    if (editor != null) return\n    // 防止重复渲染 当编辑器已经创建就不在创建了\n    if (ref.current?.getAttribute('data-w-e-textarea')) return\n\n    const newEditor = createEditor({\n      selector: ref.current,\n      config: {\n        ...defaultConfig,\n        onCreated: handleCreated,\n        onChange: handleChanged,\n        onDestroyed: handleDestroyed,\n      },\n      content: defaultContent,\n      html: defaultHtml || value,\n      mode,\n    })\n    setEditor(newEditor)\n  }, [editor])\n\n  return <div style={style} ref={ref} className={className}></div>\n}\n\nexport default EditorComponent\n","/**\n * @description toolbar react component\n * @author wangfupeng\n */\n\nimport React, { useRef, useEffect } from 'react'\nimport * as wangEditor from '@wangeditor/editor'\n\ninterface IProps {\n  editor: wangEditor.IDomEditor | null\n  defaultConfig?: Partial<wangEditor.IToolbarConfig>\n  mode?: string\n  style?: object\n  className?: string\n}\n\nfunction ToolbarComponent(props: IProps) {\n  const { editor, defaultConfig = {}, mode = 'default', style = {}, className } = props\n  const ref = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    if (ref.current == null) return\n    if (editor == null) return\n\n    wangEditor.createToolbar({\n      editor,\n      selector: ref.current,\n      config: defaultConfig,\n      mode,\n    })\n  }, [editor])\n\n  return <div style={style} ref={ref} className={className}></div>\n}\n\nexport default ToolbarComponent\n"],"names":["props","_a","defaultContent","onCreated","_b","defaultHtml","_c","value","onChange","_d","defaultConfig","_e","mode","_f","style","className","ref","useRef","_g","__read","useState","editor","setEditor","_h","curValue","setCurValue","handleCreated","onCreatedFromConfig","handleChanged","getHtml","onChangeFromConfig","handleDestroyed","onDestroyed","useEffect","setHtml","error","console","current","getAttribute","newEditor","createEditor","selector","config","__assign","content","html","React","createElement","wangEditor","createToolbar"],"mappings":"0sCAoBA,SAAyBA,GACf,IAAAC,EAAwID,EAArHE,eAAnBA,OAAiB,IAAAD,EAAA,GAAEA,EAAEE,EAAmHH,EAAKG,UAA7GC,EAAwGJ,EAAxFK,YAAhBA,OAAW,IAAAD,EAAG,GAAEA,EAAEE,EAAsFN,EAA5EO,MAAVA,OAAK,IAAAD,EAAG,GAAEA,EAAEE,EAA0ER,EAAKQ,SAArEC,EAAgET,EAAKU,cAArEA,OAAa,IAAAD,EAAG,GAAEA,EAAEE,EAA4CX,EAAKY,KAAjDA,OAAI,IAAAD,EAAG,UAASA,EAAEE,EAA0Bb,EAAKc,MAA/BA,OAAK,IAAAD,EAAG,GAAEA,EAAEE,EAAcf,YAC1IgB,EAAMC,SAAuB,MAC7BC,EAAAC,EAAsBC,EAAQA,SAAoB,MAAK,GAAtDC,EAAMH,EAAA,GAAEI,OACTC,EAAAJ,EAA0BC,EAAQA,SAAC,IAAG,GAArCI,EAAQD,EAAA,GAAEE,OAEXC,EAAgB,SAACL,GAEjBlB,GAAWA,EAAUkB,GAGjB,IAAWM,EAAwBjB,EAAaP,UACpDwB,GAAqBA,EAAoBN,IAGzCO,EAAgB,SAACP,GACrBI,EAAYJ,EAAOQ,WAGfrB,GAAUA,EAASa,GAGf,IAAUS,EAAuBpB,EAAaF,SAClDsB,GAAoBA,EAAmBT,IAGvCU,EAAkB,SAACV,GACf,IAAAW,EAAgBtB,EAAasB,YACrCV,EAAU,MACPU,GACDA,EAAYX,IAwChB,OAnCAY,EAAAA,WAAU,WACR,GAAc,MAAVZ,GAEAd,IAAUiB,EAGd,IACEH,EAAOa,QAAQ3B,GACf,MAAO4B,GACPC,QAAQD,MAAMA,MAGf,CAAC5B,IAEJ0B,EAAAA,WAAU,iBACR,GAAmB,MAAfjB,EAAIqB,SACM,MAAVhB,aAEApB,EAAAe,EAAIqB,8BAASC,aAAa,sBAA9B,CAEA,IAAMC,EAAYC,EAAAA,aAAa,CAC7BC,SAAUzB,EAAIqB,QACdK,OACKC,EAAAA,EAAA,GAAAjC,GACH,CAAAP,UAAWuB,EACXlB,SAAUoB,EACVI,YAAaD,IAEfa,QAAS1C,EACT2C,KAAMxC,GAAeE,EACrBK,KAAIA,IAENU,EAAUiB,MACT,CAAClB,IAEGyB,EAAK,QAAAC,cAAA,MAAA,CAAAjC,MAAOA,EAAOE,IAAKA,EAAKD,UAAWA,eC1EjD,SAA0Bf,GAChB,IAAAqB,EAAwErB,EAAlEqB,OAAEpB,EAAgED,EAAKU,cAArEA,aAAgB,GAAET,EAAEG,EAA4CJ,EAA5BY,KAAhBA,OAAI,IAAAR,EAAG,UAASA,EAAEE,EAA0BN,QAA1Bc,OAAQ,IAAAR,EAAA,KAAIS,EAAcf,YAC1EgB,EAAMC,SAAuB,MAcnC,OAZAgB,EAAAA,WAAU,WACW,MAAfjB,EAAIqB,SACM,MAAVhB,GAEJ2B,EAAWC,cAAc,CACvB5B,OAAMA,EACNoB,SAAUzB,EAAIqB,QACdK,OAAQhC,EACRE,KAAIA,MAEL,CAACS,IAEGyB,EAAK,QAAAC,cAAA,MAAA,CAAAjC,MAAOA,EAAOE,IAAKA,EAAKD,UAAWA"}